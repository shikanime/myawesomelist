syntax = "proto3";

package myawesomelist.v1;

import "google/protobuf/timestamp.proto";

option go_package = "myawesomelist.shikanime.studio/pkgs/proto/myawesomelist/v1;myawesomelistv1";

// Project represents a single project from an awesome list
message ProjectStats {
  uint64 id = 1;
  optional uint32 stargazers_count = 2;
  optional uint32 open_issue_count = 3;
  google.protobuf.Timestamp updated_at = 4;
}

message Project {
  uint64 id = 1;
  string name = 2;
  string description = 3;
  Repository repo = 4;
  google.protobuf.Timestamp updated_at = 5;
}

// Category groups projects under a section
message Category {
  uint64 id = 1;
  string name = 2;
  repeated Project projects = 3;
  google.protobuf.Timestamp updated_at = 4;
}

// Collection represents an awesome repository parsed into categories
message Collection {
  uint64 id = 1;
  string language = 2;
  Repository repo = 3;
  repeated Category categories = 4;
  google.protobuf.Timestamp updated_at = 5;
}

// Identify a source awesome repository (owner/repo)
message Repository {
  string hostname = 1;
  string owner = 2;
  string repo = 3;
}

// Requests/Responses

message ListCollectionsRequest {
  repeated Repository repos = 1;
}

message ListCollectionsResponse {
  repeated Collection collections = 1;
}

message GetCollectionRequest {
  Repository repo = 1;
}

message GetCollectionResponse {
  Collection collection = 1;
}

message ListCategoriesRequest {
  Repository repo = 1;
}

message ListCategoriesResponse {
  repeated Category categories = 1;
}

message ListProjectsRequest {
  Repository repo = 1;
  string category_name = 2;
}

message ListProjectsResponse {
  repeated Project projects = 1;
}

message SearchProjectsRequest {
  string query = 1;
  uint32 limit = 2;
  repeated Repository repos = 3;
}

message SearchProjectsResponse {
  repeated Project projects = 1;
}

message LivenessRequest {}
message LivenessResponse {}

message ReadinessRequest {}
message ReadinessResponse {}

message GetProjectStatsRequest {
  Repository repo = 1;
}

message GetProjectStatsResponse {
  ProjectStats stats = 1;
}

// Service

service AwesomeService {
  rpc Liveness(LivenessRequest) returns (LivenessResponse);
  rpc Readiness(ReadinessRequest) returns (ReadinessResponse);

  rpc ListCollections(ListCollectionsRequest) returns (ListCollectionsResponse);
  rpc GetCollection(GetCollectionRequest) returns (GetCollectionResponse);

  rpc ListCategories(ListCategoriesRequest) returns (ListCategoriesResponse);
  rpc ListProjects(ListProjectsRequest) returns (ListProjectsResponse);

  rpc SearchProjects(SearchProjectsRequest) returns (SearchProjectsResponse);

  rpc GetProjectStats(GetProjectStatsRequest) returns (GetProjectStatsResponse);
}